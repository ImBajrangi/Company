<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Auth System</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font family -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3ffce; /* Light, soft background */
        }
        /* Custom style for primary button color */
        .btn-primary {
            background-color: #1e40af; /* Blue-800 */
            transition: all 0.2s ease-in-out;
        }
        .btn-primary:hover {
            background-color: #1e3a8a; /* Blue-900 */
        }
        /* Custom style for Google button */
        .btn-google {
            background-color: white;
            color: #1f2937; /* Gray-800 */
            border: 1px solid #d1d5db; /* Gray-300 */
            transition: all 0.2s ease-in-out;
        }
        .btn-google:hover {
            background-color: #f9fafb; /* Gray-50 */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .btn-google:disabled {
            background-color: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
            border-color: #e5e7eb;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md">

        <!-- Auth Card Container (Shows when logged out) -->
        <div id="auth-container" class="bg-white shadow-2xl border border-gray-100 rounded-xl overflow-hidden transition-all duration-500">
            
            <!-- Header Section -->
            <div class="p-8 pb-4 bg-white border-b border-gray-100">
                <h1 class="text-4xl font-extrabold text-gray-900">
                    <span id="view-title">Sign In</span>
                </h1>
                <p id="view-subtitle" class="text-gray-600 mt-1">Access your account or create a new one instantly.</p>
            </div>

            <!-- Content Area -->
            <div class="p-8 space-y-6">
                
                <!-- Status/Error Message Display -->
                <div id="status-message" class="hidden p-3 rounded-lg text-sm transition-all duration-300"></div>

                <!-- Global Google Sign-In Button -->
                <button id="google-sign-in-button" onclick="signInWithGoogle()" class="btn-google w-full flex items-center justify-center py-3 px-4 rounded-lg shadow-sm text-base font-medium" disabled>
                    <svg class="w-5 h-5 mr-3" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M44.5 20H24v8.5h11.8c-.8 5.7-5.7 9.8-11.8 9.8-7.3 0-13.3-6-13.3-13.3S16.7 13.7 24 13.7c3.3 0 5.8 1.4 7.5 3.1l6.4-6.4C34.7 7.2 29.7 5 24 5 13.8 5 5.5 13.3 5.5 24S13.8 43 24 43c10.2 0 17.5-7.4 17.5-17.5 0-1.5-.2-2.9-.4-4.2H24v-8.5h20.5z" fill="#4285F4"/><path d="M24 43c5.3 0 9.7-1.8 12.5-4.9l-6.4-6.4c-1.7 1.7-4.2 3.1-7.5 3.1-6.1 0-11.1-4.1-13.3-9.8h-8.5C5.5 34.7 13.8 43 24 43z" fill="#34A853"/><path d="M5.5 24c0-1.5.2-2.9.4-4.2h8.5c-.5 2.6-.5 5.2 0 7.8H5.9c-.2-1.3-.4-2.7-.4-4.2z" fill="#FBBC05"/><path d="M24 13.7c3.3 0 5.8 1.4 7.5 3.1l6.4-6.4C34.7 7.2 29.7 5 24 5 13.8 5 5.5 13.3 5.5 24c0 1.5.2 2.9.4 4.2h8.5c.5-2.6.5-5.2 0-7.8h-8.5C5.7 17.1 5.5 15.6 5.5 14z" fill="#EA4335"/></svg>
                    Continue with Google
                </button>
                
                <div class="relative flex items-center justify-center">
                    <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div>
                    <div class="relative bg-white px-3 text-sm text-gray-500">OR</div>
                </div>

                <!-- Login Form (Email/Password) -->
                <form id="form-login" class="space-y-6" onsubmit="event.preventDefault(); handleAuth('login')">
                    <div>
                        <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="login-email" autocomplete="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-600 focus:ring-1 focus:ring-blue-600 transition duration-150" placeholder="your@email.com">
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="login-password" autocomplete="current-password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-600 focus:ring-1 focus:ring-blue-600 transition duration-150" placeholder="••••••••">
                    </div>
                    <div class="flex justify-between items-center pt-2">
                        <a href="#" onclick="showView('signup'); return false;" class="text-sm text-gray-600 hover:text-blue-600 font-medium transition-colors duration-150">Don't have an account? Sign Up</a>
                        <button type="submit" class="btn-primary py-2 px-6 rounded-lg text-base font-medium text-white shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Log In</button>
                    </div>
                </form>

                <!-- Sign Up Form (Email/Password) -->
                <form id="form-signup" class="space-y-6 hidden" onsubmit="event.preventDefault(); handleAuth('signup')">
                    <div>
                        <label for="signup-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="signup-name" autocomplete="name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-600 focus:ring-1 focus:ring-blue-600 transition duration-150" placeholder="John Doe">
                    </div>
                    <div>
                        <label for="signup-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="signup-email" autocomplete="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-600 focus:ring-1 focus:ring-blue-600 transition duration-150" placeholder="your@email.com">
                    </div>
                    <div>
                        <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="signup-password" autocomplete="new-password" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-600 focus:ring-1 focus:ring-blue-600 transition duration-150" placeholder="Minimum 6 characters">
                    </div>
                    <div class="flex justify-between items-center pt-2">
                        <a href="#" onclick="showView('login'); return false;" class="text-sm text-gray-600 hover:text-blue-600 font-medium transition-colors duration-150">Already have an account? Log In</a>
                        <button type="submit" class="btn-primary py-2 px-6 rounded-lg text-base font-medium text-white shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Sign Up</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Logged-In View (Shows when logged in) -->
        <div id="logged-in-container" class="hidden bg-white shadow-2xl border border-gray-100 rounded-xl p-8 text-center">
            <h2 class="text-3xl font-bold text-gray-900">Welcome!</h2>
            <p id="welcome-message" class="mt-2 text-gray-600 truncate"></p>
            <button onclick="signOutUser()" class="mt-6 w-full btn-primary py-3 px-6 rounded-lg text-base font-medium text-white shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                Sign Out
            </button>
        </div>

    </div>

    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            GoogleAuthProvider, 
            signInWithPopup,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            updateProfile,
            signOut 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables
        let auth, db;
        
        // --- Utility ---
        function displayStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = 'p-3 rounded-lg text-sm transition-all duration-300'; // Reset classes
            if (type === 'error') {
                statusDiv.classList.add('bg-red-100', 'text-red-700');
            } else {
                statusDiv.classList.add('bg-green-100', 'text-green-700');
            }
            // Auto-hide after 5 seconds
            setTimeout(() => statusDiv.classList.add('hidden'), 5000);
        }

        // --- Firebase Initialization ---
        function initFirebase() {
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyB-Wd4gZ2J9P9ycaHKwK-EHnNfdg7z9gWI",
                    authDomain: "vrindopnishad-d497.firebaseapp.com",
                    projectId: "vrindopnishad-d3497",
                    storageBucket: "vrindopnishad-d3497.firebasestorage.app",
                    messagingSenderId: "768939105927",
                    appId: "1:768939105927:web:114a8abf022e6debcf2222",
                    measurementId: "G-KF0HYQTHV5"
                };

                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                document.getElementById('google-sign-in-button').disabled = false;
                document.getElementById('google-sign-in-button').textContent = 'Continue with Google';

                onAuthStateChanged(auth, (user) => {
                    const authContainer = document.getElementById('auth-container');
                    const loggedInContainer = document.getElementById('logged-in-container');
                    if (user && !user.isAnonymous) { // Only treat real users as logged in
                        document.getElementById('welcome-message').textContent = `Logged in as ${user.displayName || user.email}`;
                        authContainer.classList.add('hidden');
                        loggedInContainer.classList.remove('hidden');
                    } else {
                        // User is signed out or anonymous
                        authContainer.classList.remove('hidden');
                        loggedInContainer.classList.add('hidden');
                    }
                });
                console.log("Firebase Initialized Successfully.");
            } catch (error) {
                console.error("Firebase Initialization Failed:", error);
                displayStatus(`Critical Error: Firebase failed to initialize. ${error.message}`, 'error');
                document.getElementById('google-sign-in-button').textContent = 'Initialization Failed';
            }
        }
        
        // --- Firestore ---
        async function createUserProfileDocument(user, additionalData = {}) {
            if (!user) return;
            const userRef = doc(db, 'users', user.uid);
            const { displayName, email } = user;
            const createdAt = serverTimestamp();
            try {
                // Use setDoc with merge:true to create or update profile
                await setDoc(userRef, {
                    displayName: displayName || additionalData.displayName,
                    email,
                    createdAt,
                    ...additionalData,
                }, { merge: true });
            } catch (error) {
                console.error("Error creating user profile:", error);
                displayStatus("Could not save user profile.", "error");
            }
        }

        // --- Authentication Logic ---
        window.handleAuth = async function(mode) {
            const email = document.getElementById(`${mode}-email`).value;
            const password = document.getElementById(`${mode}-password`).value;
            
            try {
                if (mode === 'signup') {
                    const name = document.getElementById('signup-name').value;
                    if (!name) {
                        displayStatus("Please enter your full name.", "error");
                        return;
                    }
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    // Update profile in Auth service
                    await updateProfile(user, { displayName: name });
                    // Create user document in Firestore database
                    await createUserProfileDocument(user, { displayName: name });
                    // No need for status message, onAuthStateChanged will handle the UI switch
                } else { // mode === 'login'
                    await signInWithEmailAndPassword(auth, email, password);
                    // No need for status message, onAuthStateChanged will handle the UI switch
                }
            } catch (error) {
                console.error(`${mode} Error:`, error);
                let message = "An unknown error occurred.";
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        message = "This email address is already in use by another account.";
                        break;
                    case 'auth/weak-password':
                        message = "Password should be at least 6 characters.";
                        break;
                    case 'auth/invalid-credential':
                        message = "Incorrect email or password. Please try again.";
                        break;
                    default:
                        message = "Authentication failed. Please check your details.";
                }
                displayStatus(message, 'error');
            }
        }

        window.signInWithGoogle = async function() {
            try {
                const provider = new GoogleAuthProvider();
                const result = await signInWithPopup(auth, provider);
                // Create a user profile in Firestore for new Google users as well
                await createUserProfileDocument(result.user);
            } catch (error) {
                console.error("Google Sign-In Error:", error);
                displayStatus(`Google Sign-In Failed: ${error.message}`, 'error');
            }
        }

        window.signOutUser = async function() {
            try {
                await signOut(auth);
                // The onAuthStateChanged listener will handle the UI update
            } catch (error) {
                console.error("Sign Out Error:", error);
                displayStatus("Error signing out.", "error");
            }
        }
        
        // --- UI Logic ---
        window.showView = function(view) {
            document.getElementById('form-login').classList.toggle('hidden', view !== 'login');
            document.getElementById('form-signup').classList.toggle('hidden', view !== 'signup');
            document.getElementById('view-title').textContent = view === 'login' ? 'Sign In' : 'Create Account';
            document.getElementById('view-subtitle').textContent = view === 'login' 
                ? 'Access your account or create a new one.' 
                : 'Join us today. It only takes a minute!';
            document.getElementById('status-message').classList.add('hidden'); // Clear status on view change
        }
        
        // Initialize on window load
        window.onload = initFirebase;
    </script>
</body>
</html>

<!-- 
                    apiKey: "eeAIzaSyB-Wd4gZ2J9P9ycaHKwK-EHnNfdg7z9gWIee",
                    authDomain: "vrindopnishad-d497.firebaseapp.com",
                    projectId: "vrindopnishad-d3497",
                    storageBucket: "vrindopnishad-d3497.firebasestorage.app",
                    messagingSenderId: "768939105927",
                    appId: "1:768939105927:web:de7a7244eb6e0febcf2222",
                    measurementId: "G-KF0HYQTHV5"
-->