<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Literary Hub - Collections</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="../search-less-opacity.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animista/1.0.0/animista.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4361EE',
                        secondary: '#1E2A35',
                        dark: '#040404',
                        accent: '#63B3ED',
                        purple: '#9F7AEA'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 3s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        glow: {
                            '0%, 100%': { boxShadow: '0 0 5px rgba(67, 97, 238, 0.5)' },
                            '50%': { boxShadow: '0 0 20px rgba(67, 97, 238, 0.8)' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- Ion Icons for Navigation Menu -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>
<body>
    <!-- Movable Search Bar with Fixed Initial Position -->
    <div class="movable-search-wrapper collapsed" id="movableSearch" style="position: fixed; top: 100px; right: 20px; z-index: 1001;">
        <div class="movable-search">
            <div class="search-icon" id="expandSearchIcon">
                <i class="fas fa-search"></i>
            </div>
            <input type="text" id="movableSearchInput" placeholder="Search collections, categories..." class="search-input" style="display: none;">
            <div class="close-icon" id="collapseSearchIcon" style="display: none;">
                <i class="fas fa-times"></i>
            </div>
        </div>
    </div>

    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-to-content">Skip to main content</a>
    
    <!-- Page Loader -->
    <div class="loader-container" style="display: flex; opacity: 1; visibility: visible;">
        <div class="book-loader">
            <div class="book" style="animation-play-state: paused">
                <div class="book-cover" style="animation-play-state: paused">
                    <div class="sacred-symbol"></div>
                    <div class="sacred-symbol"></div>
                    <div class="sacred-symbol"></div>
                    <div class="sacred-symbol"></div>
                    <div class="book-spine"></div>
                    <div class="book-front">
                        <div class="book-title">Literary Hub</div>
                        <div class="book-subtitle">Collections</div>
                    </div>
                </div>
                <div class="book-pages" style="animation-play-state: paused">
                    <div class="book-page" style="animation-play-state: paused">
                        <div class="sanskrit-text">
                            अथातो ब्रह्म जिज्ञासा। जन्माद्यस्य यतः। शास्त्रयोनित्वात्।
                            तत्तु समन्वयात्। ईक्षतेर्नाशब्दम्।
                            गौणश्चेन्नात्मशब्दात्। तद्धेतुव्यपदेशाच्च। स्वाप्ययात्। 
                            न चाधिकारिकमपि परनिराकरणं सर्वगतत्वाच्च।
                        </div>
                    </div>
                    <div class="book-page" style="animation-play-state: paused">
                        <div class="sanskrit-text">
                            योगश्चित्तवृत्तिनिरोधः। तदा द्रष्टुः स्वरूपेऽवस्थानम्।
                            वृत्तिसारूप्यमितरत्र। अभ्यासवैराग्याभ्यां तन्निरोधः।
                            तत्र स्थितौ यत्नोऽभ्यासः। 
                            स तु दीर्घकालनैरन्तर्यसत्कारासेवितो दृढभूमिः।
                        </div>
                    </div>
                </div>
            </div>
            <div class="magical-content">
                <div class="divine-particle" style="animation-play-state: paused"></div>
                <div class="divine-particle" style="animation-play-state: paused"></div>
                <div class="divine-particle" style="animation-play-state: paused"></div>
                <div class="divine-particle" style="animation-play-state: paused"></div>
                <div class="divine-particle" style="animation-play-state: paused"></div>
                <div class="divine-message" style="animation-play-state: paused">Explore our collections</div>
                <div class="divine-ray" style="animation-play-state: paused"></div>
                <div class="divine-ray" style="animation-play-state: paused"></div>
                <div class="divine-ray" style="animation-play-state: paused"></div>
                <div class="mandala-bg" style="animation-play-state: paused"></div>
            </div>
        </div>
        <div class="loading-text">
            Loading <span class="dots"><span>.</span><span>.</span><span>.</span></span>
        </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="navigation" style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(4, 4, 4, 0.95); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-bottom: 1px solid rgba(67, 97, 238, 0.3); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
        <div class="nav-glass-effect"></div>
        <div class="logo">
            <a href="../Gallery.html">
                <div class="logo-glow"></div>
                <img src="../image/logos/logo.png" alt="Literary Hub Logo">
                <h1>Literary<span class="accent-text">Hub</span></h1>
            </a>
        </div>
        <ul class="nav-links">
            <li><a href="../Gallery.html">Home</a></li>
            <li class="active"><a href="index.html">Collections</a></li>
            <li><a href="../Gallery.html#authors">Authors</a></li>
            <li><a href="../Gallery.html#genres">Genres</a></li>
        </ul>
    </nav>

    <!-- Hero Section with Animated Background -->
    <section class="hero" id="main-content" style="padding-top: 100px;">
        <div class="animated-bg">
            <div class="shape shape1"></div>
            <div class="shape shape2"></div>
            <div class="shape shape3"></div>
        </div>
        <div class="container">
            <div class="hero-content">
                <h2 class="animate-fade-in">Explore Our Curated Collections</h2>
                <p class="animate-slide-up">Discover our carefully curated collections of books organized by themes, awards, and special categories. Find your next literary journey through our thoughtfully assembled collections.</p>
                <button class="cta-btn animate-slide-up">Browse Collections</button>
            </div>
        </div>
    </section>

    <!-- Collection Categories Section -->
    <section class="filter-section" style="padding-top: 20px;">
        <div class="container">
            <h3>Browse by Collection Type</h3>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All Collections</button>
                <button class="filter-btn" data-filter="award">Award Winners</button>
                <button class="filter-btn" data-filter="theme">Thematic</button>
                <button class="filter-btn" data-filter="era">Historical Era</button>
                <button class="filter-btn" data-filter="special">Special Editions</button>
            </div>
        </div>
    </section>

    <!-- Collections Grid Section -->
    <section class="collections-section" style="padding-top: 40px;">
        <div class="container">
            <div class="collections-grid">
                <!-- Collection 1: Award Winners -->
                <div class="collection-card" data-category="award">
                    <div class="collection-image">
                        <img src="../image/Home Pics/library.jpg" alt="Award Winners Collection">
                        <div class="collection-overlay">
                            <span class="collection-tag">Award Winners</span>
                        </div>
                    </div>
                    <div class="collection-content">
                        <h4>Literary Award Winners</h4>
                        <p>Explore books that have won prestigious literary awards including the Pulitzer Prize, Man Booker Prize, and National Book Award.</p>
                        <div class="collection-meta">
                            <span><i class="fas fa-book"></i> 42 Books</span>
                            <span><i class="fas fa-star"></i> 4.8/5</span>
                        </div>
                        <button class="view-collection-btn">View Collection</button>
                    </div>
                </div>

                <!-- Collection 2: Classic Literature -->
                <div class="collection-card" data-category="theme">
                    <div class="collection-image">
                        <img src="../image/Home Pics/bookshelf.jpg" alt="Classic Literature Collection">
                        <div class="collection-overlay">
                            <span class="collection-tag">Thematic</span>
                        </div>
                    </div>
                    <div class="collection-content">
                        <h4>Classic Literature</h4>
                        <p>Timeless works that have shaped literary history and continue to inspire readers and writers today.</p>
                        <div class="collection-meta">
                            <span><i class="fas fa-book"></i> 56 Books</span>
                            <span><i class="fas fa-star"></i> 4.7/5</span>
                        </div>
                        <button class="view-collection-btn">View Collection</button>
                    </div>
                </div>

                <!-- Collection 3: Contemporary Bestsellers -->
                <div class="collection-card" data-category="theme">
                    <div class="collection-image">
                        <img src="../image/Home Pics/books.jpg" alt="Contemporary Bestsellers Collection">
                        <div class="collection-overlay">
                            <span class="collection-tag">Thematic</span>
                        </div>
                    </div>
                    <div class="collection-content">
                        <h4>Contemporary Bestsellers</h4>
                        <p>The most popular and critically acclaimed books published in the last few years.</p>
                        <div class="collection-meta">
                            <span><i class="fas fa-book"></i> 38 Books</span>
                            <span><i class="fas fa-star"></i> 4.5/5</span>
                        </div>
                        <button class="view-collection-btn">View Collection</button>
                    </div>
                </div>

                <!-- Collection 4: Victorian Era -->
                <div class="collection-card" data-category="era">
                    <div class="collection-image">
                        <img src="../image/Home Pics/writer.jpg" alt="Victorian Era Collection">
                        <div class="collection-overlay">
                            <span class="collection-tag">Historical Era</span>
                        </div>
                    </div>
                    <div class="collection-content">
                        <h4>Victorian Literature</h4>
                        <p>Explore the rich literary tradition of the Victorian era, featuring works by Dickens, Brontë, Eliot, and more.</p>
                        <div class="collection-meta">
                            <span><i class="fas fa-book"></i> 29 Books</span>
                            <span><i class="fas fa-star"></i> 4.6/5</span>
                        </div>
                        <button class="view-collection-btn">View Collection</button>
                    </div>
                </div>

                <!-- Collection 5: Limited Editions -->
                <div class="collection-card" data-category="special">
                    <div class="collection-image">
                        <img src="../image/Home Pics/settings.jpg" alt="Limited Editions Collection">
                        <div class="collection-overlay">
                            <span class="collection-tag">Special Editions</span>
                        </div>
                    </div>
                    <div class="collection-content">
                        <h4>Limited Edition Classics</h4>
                        <p>Beautifully bound special editions of classic works with unique illustrations and premium materials.</p>
                        <div class="collection-meta">
                            <span><i class="fas fa-book"></i> 18 Books</span>
                            <span><i class="fas fa-star"></i> 4.9/5</span>
                        </div>
                        <button class="view-collection-btn">View Collection</button>
                    </div>
                </div>

                <!-- Collection 6: Nobel Prize Winners -->
                <div class="collection-card" data-category="award">
                    <div class="collection-image">
                        <img src="../image/Books/book1.jpg" alt="Nobel Prize Winners Collection">
                        <div class="collection-overlay">
                            <span class="collection-tag">Award Winners</span>
                        </div>
                    </div>
                    <div class="collection-content">
                        <h4>Nobel Prize in Literature</h4>
                        <p>A collection of works by authors who have been awarded the prestigious Nobel Prize in Literature.</p>
                        <div class="collection-meta">
                            <span><i class="fas fa-book"></i> 32 Books</span>
                            <span><i class="fas fa-star"></i> 4.8/5</span>
                        </div>
                        <button class="view-collection-btn">View Collection</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Collection Spotlight -->
    <section class="featured-collection-section" style="padding-top: 40px;">
        <div class="container">
            <div class="heading-container">
                <div class="heading-glow"></div>
                <h3 id="featured-heading">Featured Collection</h3>
            </div>
            <div class="featured-collection-container">
                <div class="featured-collection-image">
                    <img src="../image/Books/book2.jpg" alt="Featured Collection">
                    <div class="featured-collection-badge">
                        <span>Featured</span>
                    </div>
                </div>
                <div class="featured-collection-details">
                    <h4>Women in Literature</h4>
                    <p class="featured-collection-description">
                        Celebrating the extraordinary contributions of women authors throughout literary history. This collection showcases powerful voices that have shaped literature and challenged societal norms through their writing.
                    </p>
                    <div class="featured-collection-stats">
                        <div class="stat">
                            <span class="stat-value">45</span>
                            <span class="stat-label">Books</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">28</span>
                            <span class="stat-label">Authors</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">4.9</span>
                            <span class="stat-label">Rating</span>
                        </div>
                    </div>
                    <div class="featured-collection-books">
                        <div class="mini-book">
                            <img src="../image/Books/book3.jpg" alt="Book in collection">
                        </div>
                        <div class="mini-book">
                            <img src="../image/Books/book4.jpg" alt="Book in collection">
                        </div>
                        <div class="mini-book">
                            <img src="../image/Books/book5.jpg" alt="Book in collection">
                        </div>
                        <div class="mini-book more-books">
                            <span>+42</span>
                        </div>
                    </div>
                    <button class="explore-featured-btn">Explore This Collection</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Newsletter Section -->
    <section class="newsletter-section" style="padding-top: 40px;">
        <div class="container">
            <div class="newsletter-content">
                <h3>Stay Updated with New Collections</h3>
                <p>Subscribe to our newsletter to receive updates on new collections, featured books, and exclusive reading recommendations tailored to your interests.</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Enter your email address" required>
                    <button type="submit">Subscribe</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About Literary Hub</h3>
                    <p>Literary Hub is a curated collection of books spanning various genres, authors, and time periods. Our mission is to connect readers with their next literary adventure.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-pinterest"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="../Gallery.html"><i class="fas fa-angle-right"></i> Home</a></li>
                        <li><a href="../Gallery.html#gallery"><i class="fas fa-angle-right"></i> Books</a></li>
                        <li><a href="#"><i class="fas fa-angle-right"></i> Collections</a></li>
                        <li><a href="#"><i class="fas fa-angle-right"></i> Genres</a></li>
                        <li><a href="#"><i class="fas fa-angle-right"></i> About Us</a></li>
                        <li><a href="#"><i class="fas fa-angle-right"></i> Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> 123 Book Street, Literary City</li>
                        <li><i class="fas fa-phone"></i> +1 (555) 123-4567</li>
                        <li><i class="fas fa-envelope"></i> info@literaryhub.com</li>
                        <li><i class="fas fa-clock"></i> Mon - Fri: 9:00 AM - 8:00 PM</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Literary Hub. All Rights Reserved. | Designed with <i class="fas fa-heart"></i> for book lovers</p>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button class="back-to-top" aria-label="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Collection Preview Modal -->
    <div class="modal" id="collectionPreviewModal">
        <div class="modal-content collection-preview">
            <span class="close-modal">&times;</span>
            <div class="collection-preview-header">
                <h2 class="collection-title">Literary Award Winners</h2>
                <div class="collection-stats">
                    <span><i class="fas fa-book"></i> 42 Books</span>
                    <span><i class="fas fa-star"></i> 4.8/5 Average Rating</span>
                    <span><i class="fas fa-calendar-alt"></i> Updated Monthly</span>
                </div>
            </div>
            <div class="collection-description">
                <p>Explore books that have won prestigious literary awards including the Pulitzer Prize, Man Booker Prize, and National Book Award. This collection showcases the most acclaimed works of fiction, non-fiction, and poetry from around the world.</p>
            </div>
            <div class="collection-categories">
                <h3>Categories in this Collection</h3>
                <div class="category-tags">
                    <span class="category-tag">Pulitzer Prize</span>
                    <span class="category-tag">Man Booker Prize</span>
                    <span class="category-tag">National Book Award</span>
                    <span class="category-tag">Nobel Prize</span>
                    <span class="category-tag">Costa Book Awards</span>
                </div>
            </div>
            <div class="collection-books-preview">
                <h3>Featured Books in this Collection</h3>
                <div class="preview-books-grid">
                    <div class="preview-book-card">
                        <img src="../image/Books/book1.jpg" alt="Book Cover">
                        <div class="preview-book-info">
                            <h4>The Great Gatsby</h4>
                            <p>F. Scott Fitzgerald</p>
                            <div class="preview-book-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                <span>(4.5)</span>
                            </div>
                        </div>
                    </div>
                    <div class="preview-book-card">
                        <img src="../image/Books/book2.jpg" alt="Book Cover">
                        <div class="preview-book-info">
                            <h4>To Kill a Mockingbird</h4>
                            <p>Harper Lee</p>
                            <div class="preview-book-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <span>(5.0)</span>
                            </div>
                        </div>
                    </div>
                    <div class="preview-book-card">
                        <img src="../image/Books/book3.jpg" alt="Book Cover">
                        <div class="preview-book-info">
                            <h4>Sapiens</h4>
                            <p>Yuval Noah Harari</p>
                            <div class="preview-book-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                <span>(4.7)</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="view-all-container">
                    <button class="view-all-books-btn">View All 42 Books</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Settings</h2>
            <div class="settings-section">
                <h3>Theme</h3>
                <div class="theme-options">
                    <button class="theme-btn active" data-theme="dark">Dark</button>
                    <button class="theme-btn" data-theme="light-mode">Light</button>
                </div>
            </div>
            <div class="settings-section">
                <h3>Font Size</h3>
                <div class="font-options">
                    <button class="font-btn" data-font="small">Small</button>
                    <button class="font-btn active" data-font="medium">Medium</button>
                    <button class="font-btn" data-font="large">Large</button>
                </div>
            </div>
            <div class="settings-section">
                <h3>Animation Speed</h3>
                <input type="range" min="0.5" max="2" step="0.1" value="1" class="animation-speed" id="animationSpeed">
                <span class="speed-value">1x</span>
            </div>
            <button class="save-settings">Save Settings</button>
        </div>
    </div>

    <script src="index.js"></script>
    <script src="collection-detail.js"></script>
    <script src="fix-search.js"></script>
    <!--<script src="../Gallery.js"></script>-->

    <!-- API Integration Scripts -->
    <script>
    // API Base URL
    const API_BASE_URL = 'http://localhost:5000/api';
    
    // Get token from localStorage
    const getToken = () => localStorage.getItem('token');
    
    // Headers with authentication
    const getAuthHeaders = () => {
        const token = getToken();
        const headers = {
            'Content-Type': 'application/json'
        };
        
        if (token) {
            headers['Authorization'] = `Bearer ${token}`;
        }
        
        return headers;
    };
    
    // Books API
    const booksAPI = {
        // Get all books with optional filters
        async getBooks(filters = {}) {
            try {
                // Build query string from filters
                const queryParams = new URLSearchParams();
                Object.keys(filters).forEach(key => {
                    if (filters[key]) {
                        queryParams.append(key, filters[key]);
                    }
                });
                
                const queryString = queryParams.toString() ? `?${queryParams.toString()}` : '';
                const response = await fetch(`${API_BASE_URL}/books${queryString}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch books');
                }
                
                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error('Error fetching books:', error);
                return [];
            }
        },
        
        // Get a single book by ID
        async getBook(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/books/${id}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch book');
                }
                
                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error(`Error fetching book ${id}:`, error);
                return null;
            }
        },
        
        // Add a review to a book
        async addReview(bookId, review) {
            try {
                const response = await fetch(`${API_BASE_URL}/books/${bookId}/reviews`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(review)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to add review');
                }
                
                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error('Error adding review:', error);
                throw error;
            }
        }
    };
    
    // Collections API
    const collectionsAPI = {
        // Get all collections
        async getCollections() {
            try {
                const response = await fetch(`${API_BASE_URL}/collections`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch collections');
                }
                
                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error('Error fetching collections:', error);
                return [];
            }
        },
        
        // Get a single collection by ID
        async getCollection(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/collections/${id}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch collection');
                }
                
                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error(`Error fetching collection ${id}:`, error);
                return null;
            }
        },
        
        // Create a new collection (requires authentication)
        async createCollection(collection) {
            try {
                const response = await fetch(`${API_BASE_URL}/collections`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(collection)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to create collection');
                }
                
                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error('Error creating collection:', error);
                throw error;
            }
        },
        
        // Add a book to a collection
        async addBookToCollection(collectionId, bookId) {
            try {
                const response = await fetch(`${API_BASE_URL}/collections/${collectionId}/books/${bookId}`, {
                    method: 'POST',
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error('Failed to add book to collection');
                }
                
                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error('Error adding book to collection:', error);
                throw error;
            }
        }
    };
    
    // Auth API
    const authAPI = {
        // Register a new user
        async register(userData) {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Registration failed');
                }
                
                // Save token to localStorage
                if (data.token) {
                    localStorage.setItem('token', data.token);
                }
                
                return data;
            } catch (error) {
                console.error('Error registering user:', error);
                throw error;
            }
        },
        
        // Login user
        async login(email, password) {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Login failed');
                }
                
                // Save token to localStorage
                if (data.token) {
                    localStorage.setItem('token', data.token);
                }
                
                return data;
            } catch (error) {
                console.error('Error logging in:', error);
                throw error;
            }
        },
        
        // Logout user
        async logout() {
            try {
                // Clear token from localStorage
                localStorage.removeItem('token');
                
                // Call logout endpoint
                await fetch(`${API_BASE_URL}/auth/logout`, {
                    headers: getAuthHeaders()
                });
                
                return true;
            } catch (error) {
                console.error('Error logging out:', error);
                return false;
            }
        },
        
        // Get current user profile
        async getCurrentUser() {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/me`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error('Failed to get user profile');
                }
                
                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error('Error fetching user profile:', error);
                return null;
            }
        },
        
        // Check if user is logged in
        isLoggedIn() {
            return !!getToken();
        }
    };

    // Initialize the page with data from the API
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            // Check if user is logged in
            if (authAPI.isLoggedIn()) {
                const user = await authAPI.getCurrentUser();
                if (user) {
                    console.log('Logged in as:', user.username);
                    // Update UI for logged in user
                    updateUIForLoggedInUser(user);
                }
            }
            
            // Load collections from API
            const collections = await collectionsAPI.getCollections();
            if (collections && collections.length > 0) {
                // Render collections
                renderCollections(collections);
            }
        } catch (error) {
            console.error('Error initializing page:', error);
        }
    });

    // Function to update UI for logged in user
    function updateUIForLoggedInUser(user) {
        // Add user profile link to navigation
        const navLinks = document.querySelector('.nav-links');
        if (navLinks) {
            const profileLi = document.createElement('li');
            profileLi.innerHTML = `
                <a href="#profile">
                    <i class="fas fa-user"></i>
                    <span>${user.username}</span>
                </a>
            `;
            navLinks.appendChild(profileLi);
            
            // Add logout button
            const logoutLi = document.createElement('li');
            logoutLi.innerHTML = `
                <a href="#" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            `;
            navLinks.appendChild(logoutLi);
            
            // Add logout event listener
            document.getElementById('logoutBtn').addEventListener('click', async function(e) {
                e.preventDefault();
                await authAPI.logout();
                window.location.reload();
            });
        }
    }

    // Function to render collections
    function renderCollections(collections) {
        const collectionsGrid = document.querySelector('.collections-grid');
        if (!collectionsGrid) return;
        
        // Clear existing content
        collectionsGrid.innerHTML = '';
        
        // Add collections to the grid
        collections.forEach(collection => {
            const collectionCard = document.createElement('div');
            collectionCard.className = 'collection-card';
            collectionCard.dataset.category = collection.category ? collection.category.toLowerCase() : 'theme';
            
            collectionCard.innerHTML = `
                <div class="collection-image">
                    <img src="${collection.coverImage || '../image/Home Pics/library.jpg'}" alt="${collection.name}">
                    <div class="collection-overlay">
                        <span class="collection-tag">${collection.category || 'Thematic'}</span>
                    </div>
                </div>
                <div class="collection-content">
                    <h4>${collection.name}</h4>
                    <p>${collection.description || 'No description available.'}</p>
                    <div class="collection-meta">
                        <span><i class="fas fa-book"></i> ${collection.books ? collection.books.length : 0} Books</span>
                        <span><i class="fas fa-eye"></i> ${collection.views || 0} Views</span>
                    </div>
                    <button class="view-collection-btn" data-id="${collection._id}">View Collection</button>
                </div>
            `;
            
            collectionsGrid.appendChild(collectionCard);
        });
        
        // Add event listeners to view collection buttons
        document.querySelectorAll('.view-collection-btn').forEach(button => {
            button.addEventListener('click', function() {
                const collectionId = this.dataset.id;
                window.location.href = `collection-detail.html?id=${collectionId}`;
            });
        });
    }
    </script>
</body>
</html>
