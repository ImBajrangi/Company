<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PDF Viewer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        /* Basic styling for the PDF viewer */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --background-color: #0a0a0f;
            --surface-color: #1a1a2e;
            --text-color: #ffffff;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .app-container {
            position: relative;
            min-height: 100vh;
            z-index: 1;
        }
        
        header {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--primary-color);
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .logo i {
            font-size: 2rem;
        }
        
        .logo span {
            color: var(--text-color);
        }
        
        .file-name {
            color: var(--text-muted);
            font-size: 0.9rem;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .primary-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }
        
        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .icon-btn {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .icon-btn:hover {
            color: var(--text-color);
            border-color: var(--primary-color);
        }
        
        .hidden {
            display: none !important;
        }
        
        main {
            padding: 1rem;
        }
        
        .drop-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            border: 2px dashed var(--border-color);
            border-radius: 1rem;
            background: rgba(26, 26, 46, 0.5);
            backdrop-filter: blur(10px);
            text-align: center;
            padding: 3rem;
            margin: 2rem auto;
            max-width: 600px;
            transition: all 0.3s ease;
        }
        
        .drop-area.active {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .drop-message i {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .drop-message h2 {
            margin-bottom: 1rem;
            color: var(--text-color);
        }
        
        .drop-message p {
            color: var(--text-muted);
            margin-bottom: 2rem;
        }
        
        .pdf-selector {
            background: var(--surface-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 400px;
        }
        
        .pdf-selector:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .file-input-label {
            background: var(--primary-color);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            cursor: pointer;
            display: inline-block;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .file-input-label:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .toolbar {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
            flex-wrap: wrap;
            display: none;
        }
        
        .toolbar.active {
            display: flex;
        }
        
        .zoom-controls, .page-controls, .view-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tool-btn {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            padding: 0.5rem;
            border-radius: 0.375rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            min-width: 40px;
            height: 40px;
        }
        
        .tool-btn:not(:disabled):hover {
            color: var(--text-color);
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .tool-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-info {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
            border: 1px solid var(--primary-color);
        }
        
        #zoom-level {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
            border: 1px solid var(--primary-color);
            min-width: 60px;
            text-align: center;
        }
        
        .pdf-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            overflow: auto;
            border: 1px solid var(--border-color);
        }
        
        #pdf-canvas {
            max-width: 100%;
            max-height: 100%;
            box-shadow: var(--shadow-lg);
            border-radius: 0.5rem;
        }
        
        .nav-arrows {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 10;
        }
        
        .nav-arrow {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            pointer-events: auto;
            margin: 0 1rem;
            opacity: 0.7;
        }
        
        .nav-arrow:hover {
            background: var(--primary-color);
            opacity: 1;
            transform: scale(1.1);
        }
        
        .sidebar {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border-left: 1px solid var(--border-color);
            transition: right 0.3s ease;
            z-index: 200;
            overflow: hidden;
        }
        
        .sidebar.open {
            right: 0;
        }
        
        .sidebar-toggle {
            position: fixed;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 50%;
            cursor: pointer;
            z-index: 150;
            display: none;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
        }
        
        .sidebar-toggle.active {
            display: block;
        }
        
        .sidebar-toggle:hover {
            background: var(--primary-dark);
            transform: translateY(-50%) scale(1.1);
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .thumbnails {
            padding: 1rem;
            height: calc(100vh - 80px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .thumbnail {
            border: 2px solid transparent;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            position: relative;
        }
        
        .thumbnail:hover {
            border-color: var(--primary-color);
            transform: scale(1.02);
        }
        
        .thumbnail.active {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
            box-shadow: 0 0 8px 1px var(--primary-color);
        }
        
        .thumbnail canvas {
            width: 100%;
            height: auto;
            border-radius: 0.25rem;
        }
        
        .thumbnail-placeholder {
            width: 100%;
            aspect-ratio: 0.707;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .thumbnail-number {
            position: absolute;
            bottom: 0.25rem;
            right: 0.25rem;
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .loader.active {
            opacity: 1;
            visibility: visible;
        }
        
        .loader-content {
            text-align: center;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loader-text {
            color: var(--text-color);
            font-size: 1.1rem;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--surface-color);
            border-radius: 0.75rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow: auto;
            border: 1px solid var(--border-color);
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h3 {
            color: var(--error-color);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
        }
        
        .constellation-lines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .constellation-star {
            position: absolute;
            background: rgba(99, 102, 241, 0.6);
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite alternate;
        }
        
        .constellation-line {
            position: absolute;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.3), transparent);
            transform-origin: left center;
            animation: pulse 5s ease-in-out infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }
        
        @keyframes pulse {
            0% { opacity: 0.2; }
            100% { opacity: 0.6; }
        }
        
        .keyboard-hint {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: var(--text-muted);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .pdf-container:hover .keyboard-hint {
            opacity: 1;
        }
        
        .keyboard-hint span {
            color: var(--primary-color);
            font-weight: 600;
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .header-left, .header-right {
                justify-content: center;
            }
            
            .logo {
                justify-content: center;
            }
            
            .toolbar {
                flex-direction: column;
                gap: 1rem;
            }
            
            .zoom-controls, .page-controls, .view-controls {
                justify-content: center;
            }
            
            .sidebar {
                width: 100%;
                right: -100%;
            }
            
            .nav-arrow {
                padding: 0.75rem;
                font-size: 1rem;
                margin: 0 0.5rem;
            }
        }
    </style>
</head>
<body class="dark-theme">
    <div class="constellation-lines" id="space-background"></div>
    
    <div class="app-container">
        <header>
            <div class="header-left">
                <div class="logo">
                    <i class="fas fa-file-pdf"></i>
                    <h1>PDF <span>Viewer</span></h1>
                </div>
                <div class="file-name" id="file-name">No file selected</div>
            </div>
            <div class="header-right">
                <button id="theme-toggle" class="icon-btn" title="Toggle Theme">
                    <i class="fas fa-sun"></i>
                </button>
                <button id="open-file-btn" class="primary-btn">
                    <i class="fas fa-folder-open"></i>
                    <span class="btn-text">Open PDF</span>
                </button>
                <input type="file" id="file-input" accept="application/pdf" class="hidden">
            </div>
        </header>
        
        <main>
            <div class="toolbar" id="toolbar">
                <div class="zoom-controls">
                    <button id="zoom-out" class="tool-btn" disabled title="Zoom Out">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <span id="zoom-level">100%</span>
                    <button id="zoom-in" class="tool-btn" disabled title="Zoom In">
                        <i class="fas fa-search-plus"></i>
                    </button>
                </div>
                
                <div class="page-controls">
                    <button id="prev-page" class="tool-btn" disabled title="Previous Page">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="page-info">
                        <span id="current-page">0</span> / <span id="total-pages">0</span>
                    </div>
                    <button id="next-page" class="tool-btn" disabled title="Next Page">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <div class="view-controls">
                    <button id="rotate-btn" class="tool-btn" disabled title="Rotate">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button id="fullscreen-btn" class="tool-btn" disabled title="Fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button id="download-btn" class="tool-btn" disabled title="Download">
                        <i class="fas fa-download"></i>
                    </button>
                    <button id="print-btn" class="tool-btn" disabled title="Print">
                        <i class="fas fa-print"></i>
                    </button>
                </div>
            </div>
            
            <div class="pdf-container" id="pdf-container">
                <canvas id="pdf-canvas"></canvas>
                
                <div class="nav-arrows">
                    <div class="nav-arrow prev" id="left-arrow" title="Previous Page" style="display: none;">
                        <i class="fas fa-chevron-left"></i>
                    </div>
                    <div class="nav-arrow next" id="right-arrow" title="Next Page" style="display: none;">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                
                <div class="keyboard-hint">
                    <span>←</span> Previous | <span>→</span> Next | <span>+</span> Zoom In | <span>-</span> Zoom Out | <span>F</span> Fullscreen | <span>T</span> Theme
                </div>
            </div>
            
            <div class="drop-area" id="drop-area">
                <div class="drop-message">
                    <i class="fas fa-file-pdf"></i>
                    <h2>Open a PDF File</h2>
                    <p>Select from the list below, drag & drop your PDF here, or click to browse</p>
                    <label class="file-input-label" for="file-input">Browse Files</label>
                </div>
            </div>
        </main>
        
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Pages</h3>
                <button id="close-sidebar" class="icon-btn" title="Close Sidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="thumbnails" id="thumbnails-container"></div>
        </div>
        
        <button class="sidebar-toggle" id="sidebar-toggle" title="Toggle Thumbnails">
            <i class="fas fa-chevron-left"></i>
        </button>
    </div>
    
    <div class="loader" id="loader">
        <div class="loader-content">
            <div class="spinner"></div>
            <div class="loader-text">Loading PDF...</div>
        </div>
    </div>
    
    <div class="modal" id="error-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Error</h3>
                <button class="close-modal-btn icon-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="error-message"></p>
            </div>
            <div class="modal-footer">
                <button class="primary-btn close-modal-btn">OK</button>
            </div>
        </div>
    </div>

    <script>
        // PDF.js variables
        let pdfDoc = null;
        let pageNum = 1;
        let pageRendering = false;
        let pageNumPending = null;
        let scale = 1.0;
        let rotation = 0;
        let pdfData = null;
        let isDarkTheme = true;
        let isMobile = window.innerWidth <= 768;

        // DOM Elements
        const canvas = document.getElementById('pdf-canvas');
        const ctx = canvas.getContext('2d');
        const fileInput = document.getElementById('file-input');
        const openFileBtn = document.getElementById('open-file-btn');
        const downloadBtn = document.getElementById('download-btn');
        const printBtn = document.getElementById('print-btn');
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const zoomLevelText = document.getElementById('zoom-level');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const currentPageText = document.getElementById('current-page');
        const totalPagesText = document.getElementById('total-pages');
        const rotateBtn = document.getElementById('rotate-btn');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const dropArea = document.getElementById('drop-area');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const closeSidebarBtn = document.getElementById('close-sidebar');
        const thumbnailsContainer = document.getElementById('thumbnails-container');
        const loader = document.getElementById('loader');
        const fileNameElement = document.getElementById('file-name');
        const errorModal = document.getElementById('error-modal');
        const errorMessage = document.getElementById('error-message');
        const closeModalBtns = document.querySelectorAll('.close-modal-btn');
        const leftArrow = document.getElementById('left-arrow');
        const rightArrow = document.getElementById('right-arrow');
        const themeToggle = document.getElementById('theme-toggle');
        const toolbar = document.getElementById('toolbar');

        // PDF files from JSON
        let availablePdfs = [];

        // Initialize the application
        function init() {
            detectMobileDevice();
            setupEventListeners();
            setupDragAndDrop();
            drawConstellationLines();
            loadPdfData();
        }

        // Setup event listeners
        function setupEventListeners() {
            fileInput.addEventListener('change', handleFileSelect);
            openFileBtn.addEventListener('click', () => fileInput.click());
            downloadBtn.addEventListener('click', downloadPDF);
            printBtn.addEventListener('click', printPDF);
            zoomInBtn.addEventListener('click', () => {
                if (scale < 3.0) {
                    scale += 0.25;
                    updateZoomLevel();
                    queueRenderPage(pageNum);
                }
            });
            zoomOutBtn.addEventListener('click', () => {
                if (scale > 0.5) {
                    scale -= 0.25;
                    updateZoomLevel();
                    queueRenderPage(pageNum);
                }
            });
            prevPageBtn.addEventListener('click', onPrevPage);
            nextPageBtn.addEventListener('click', onNextPage);
            leftArrow.addEventListener('click', onPrevPage);
            rightArrow.addEventListener('click', onNextPage);
            rotateBtn.addEventListener('click', () => {
                rotation = (rotation + 90) % 360;
                queueRenderPage(pageNum);
            });
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            sidebarToggle.addEventListener('click', toggleSidebar);
            closeSidebarBtn.addEventListener('click', toggleSidebar);
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', () => errorModal.classList.remove('show'));
            });
            themeToggle.addEventListener('click', toggleTheme);

            window.addEventListener('resize', () => {
                detectMobileDevice();
                if (pdfDoc) {
                    queueRenderPage(pageNum);
                }
            });

            window.addEventListener('keydown', handleKeyDown);
        }

        // Load PDF data from JSON
        async function loadPdfData() {
            try {
                // For demo purposes, use the embedded data
                // In production, this would fetch from your JSON file
                const response = await fetch('/class/json/pdf-links.json').catch(() => {
                    // Fallback to embedded data if file not found
                    return { ok: false };
                });
                
                let data;
                if (response.ok) {
                    data = await response.json();
                } else {
                    // Embedded fallback data
                    data = {
                        "pdfFiles": [
                            {
                                "id": 1,
                                "title": "Sample Document 1",
                                "path": "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                                "description": "A sample PDF document for testing purposes"
                            },
                            {
                                "id": 2,
                                "title": "JavaScript Guide",
                                "path": "https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf",
                                "description": "TraceMonkey: Dynamic Language Optimization"
                            },
                            {
                                "id": 3,
                                "title": "PDF.js Example",
                                "path": "https://raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/examples/learning/helloworld.pdf",
                                "description": "Hello World PDF example"
                            }
                        ]
                    };
                }
                
                availablePdfs = data.pdfFiles || [];
                createPdfSelector(availablePdfs);
                
                // Check for PDF ID in URL
                const urlParams = new URLSearchParams(window.location.search);
                const pdfId = urlParams.get('pdf');
                
                if (pdfId) {
                    const selectedPdf = availablePdfs.find(pdf => pdf.id === parseInt(pdfId));
                    if (selectedPdf) {
                        fileNameElement.textContent = selectedPdf.title;
                        loadPdfFromUrl(selectedPdf.path);
                    }
                }
            } catch (error) {
                console.error('Error loading PDFs:', error);
                showError('Could not load PDF list: ' + error.message);
            }
        }

        // Create PDF selector dropdown
        function createPdfSelector(pdfs) {
            if (pdfs.length === 0) return;
            
            const selectorContainer = document.createElement('div');
            selectorContainer.style.width = '100%';
            selectorContainer.style.marginBottom = '2rem';
            
            const selector = document.createElement('select');
            selector.className = 'pdf-selector';
            
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select a PDF from the list';
            selector.appendChild(defaultOption);
            
            pdfs.forEach(pdf => {
                const option = document.createElement('option');
                option.value = pdf.path;
                option.textContent = pdf.title;
                option.setAttribute('data-id', pdf.id);
                selector.appendChild(option);
            });
            
            selector.addEventListener('change', (e) => {
                if (e.target.value) {
                    const selectedPdf = pdfs.find(pdf => pdf.path === e.target.value);
                    if (selectedPdf) {
                        fileNameElement.textContent = selectedPdf.title;
                        loadPdfFromUrl(selectedPdf.path);
                    }
                }
            });
            
            selectorContainer.appendChild(selector);
            
            const dropMessage = dropArea.querySelector('.drop-message');
            dropMessage.insertBefore(selectorContainer, dropMessage.querySelector('.file-input-label'));
        }

        // Load PDF from URL
        function loadPdfFromUrl(url) {
            showLoader();
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.arrayBuffer();
                })
                .then(arrayBuffer => {
                    const uint8Array = new Uint8Array(arrayBuffer);
                    pdfData = uint8Array;
                    loadPDF(uint8Array);
                    dropArea.style.display = 'none';
                    toolbar.classList.add('active');
                    sidebarToggle.classList.add('active');
                    leftArrow.style.display = 'flex';
                    rightArrow.style.display = 'flex';
                })
                .catch(error => {
                    console.error('Error loading PDF from URL:', error);
                    showError('Error loading PDF: ' + error.message);
                    hideLoader();
                });
        }

        // Detect mobile device
        function detectMobileDevice() {
            isMobile = window.innerWidth <= 768;
            document.body.classList.toggle('mobile-device', isMobile);
        }

        // Handle file selection
        function handleFileSelect(e) {
            const file = e.target ? e.target.files[0] : e;
            
            if (file && file.type === 'application/pdf') {
                const fileName = file.name || 'document.pdf';
                fileNameElement.textContent = fileName;
                
                window.originalFile = file;
                showLoader();
                
                const fileReader = new FileReader();
                
                fileReader.onload = function(event) {
                    const typedArray = new Uint8Array(event.target.result);
                    pdfData = typedArray;
                    loadPDF(typedArray);
                };
                
                fileReader.readAsArrayBuffer(file);
                
                dropArea.style.display = 'none';
                toolbar.classList.add('active');
                sidebarToggle.classList.add('active');
                leftArrow.style.display = 'flex';
                rightArrow.style.display = 'flex';
            } else {
                showError('Please select a valid PDF file.');
            }
        }

        // Load the PDF document
        function loadPDF(data) {
            const loadingTask = pdfjsLib.getDocument({
                data: data,
                rangeChunkSize: 65536,
                disableAutoFetch: false,
                disableStream: false
            });

            loadingTask.promise.then(function(pdf) {
                pdfDoc = pdf;
                totalPagesText.textContent = pdf.numPages;
                enableControls();
                pageNum = 1;
                renderPage(pageNum);
                generateThumbnails(pdf);
            }).catch(function(error) {
                console.error('Error loading PDF:', error);
                showError('Error loading PDF: ' + error.message);
                hideLoader();
            });
        }

        // Render a page
        function renderPage(num) {
            pageRendering = true;
            showLoader();
            
            pdfDoc.getPage(num).then(function(page) {
                const viewport = page.getViewport({ scale: scale, rotation: rotation });
                
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                if (isMobile) {
                    const containerWidth = document.querySelector('.pdf-container').clientWidth - 20;
                    const scaleFactor = containerWidth / viewport.width;
                    
                    if (scaleFactor < 1) {
                        canvas.style.width = '100%';
                        canvas.style.height = 'auto';
                    } else {
                        canvas.style.width = '';
                        canvas.style.height = '';
                    }
                } else {
                    canvas.style.width = '';
                    canvas.style.height = '';
                }
                
                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                
                const renderTask = page.render(renderContext);
                
                renderTask.promise.then(function() {
                    pageRendering = false;
                    hideLoader();
                    updateActiveThumbnail();
                    updateNavigationArrows();
                    
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                }).catch(function(error) {
                    console.error('Error rendering page:', error);
                    pageRendering = false;
                    hideLoader();
                    showError('Error rendering page: ' + error.message);
                });
            });
            
            currentPageText.textContent = num;
        }

        // Queue rendering of a page
        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }

        // Display previous page
        function onPrevPage() {
            if (pageNum <= 1 || !pdfDoc) return;
            pageNum--;
            queueRenderPage(pageNum);
        }

        // Display next page
        function onNextPage() {
            if (!pdfDoc || pageNum >= pdfDoc.numPages) return;
            pageNum++;
            queueRenderPage(pageNum);
        }

        // Update zoom level display
        function updateZoomLevel() {
            zoomLevelText.textContent = Math.round(scale * 100) + '%';
        }

        // Update navigation arrows
        function updateNavigationArrows() {
            if (pdfDoc) {
                leftArrow.style.opacity = pageNum <= 1 ? '0.3' : '0.7';
                leftArrow.style.pointerEvents = pageNum <= 1 ? 'none' : 'auto';
                
                rightArrow.style.opacity = pageNum >= pdfDoc.numPages ? '0.3' : '0.7';
                rightArrow.style.pointerEvents = pageNum >= pdfDoc.numPages ? 'none' : 'auto';
            }
        }

        // Generate thumbnails
        function generateThumbnails(pdf) {
            thumbnailsContainer.innerHTML = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'thumbnail';
                thumbnail.setAttribute('data-page', i);
                
                const placeholderCanvas = document.createElement('div');
                placeholderCanvas.className = 'thumbnail-placeholder';
                
                const pageNumDiv = document.createElement('div');
                pageNumDiv.className = 'thumbnail-number';
                pageNumDiv.textContent = i;
                
                thumbnail.appendChild(placeholderCanvas);
                thumbnail.appendChild(pageNumDiv);
                thumbnailsContainer.appendChild(thumbnail);
                
                thumbnail.addEventListener('click', function() {
                    pageNum = parseInt(this.getAttribute('data-page'));
                    queueRenderPage(pageNum);
                    
                    if (isMobile) {
                        sidebar.classList.remove('open');
                    }
                });
                
                if (i === 1) {
                    thumbnail.classList.add('active');
                }
                
                // Load thumbnail
                pdf.getPage(i).then(function(page) {
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    const viewport = page.getViewport({ scale: 0.2 });
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    
                    page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise.then(function() {
                        const thumbElement = thumbnailsContainer.querySelector(`[data-page="${i}"] .thumbnail-placeholder`);
                        if (thumbElement) {
                            thumbElement.parentNode.replaceChild(canvas, thumbElement);
                        }
                    });
                });
            }
        }

        // Update active thumbnail
        function updateActiveThumbnail() {
            const thumbnails = document.querySelectorAll('.thumbnail');
            thumbnails.forEach((thumbnail) => {
                const page = parseInt(thumbnail.getAttribute('data-page'));
                if (page === pageNum) {
                    thumbnail.classList.add('active');
                    thumbnail.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    thumbnail.classList.remove('active');
                }
            });
        }

        // Toggle sidebar
        function toggleSidebar() {
            sidebar.classList.toggle('open');
            const icon = sidebarToggle.querySelector('i');
            if (sidebar.classList.contains('open')) {
                icon.className = 'fas fa-chevron-right';
            } else {
                icon.className = 'fas fa-chevron-left';
            }
        }

        // Toggle fullscreen
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // Toggle theme
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            isDarkTheme = document.body.classList.contains('dark-theme');
            
            const themeIcon = themeToggle.querySelector('i');
            themeIcon.className = isDarkTheme ? 'fas fa-sun' : 'fas fa-moon';
            
            drawConstellationLines();
            
            if (pdfDoc) {
                queueRenderPage(pageNum);
            }
        }

        // Enable controls
        function enableControls() {
            downloadBtn.disabled = false;
            printBtn.disabled = false;
            zoomInBtn.disabled = false;
            zoomOutBtn.disabled = false;
            prevPageBtn.disabled = false;
            nextPageBtn.disabled = false;
            rotateBtn.disabled = false;
            fullscreenBtn.disabled = false;
        }

        // Download PDF
        function downloadPDF() {
            if (!pdfData) {
                showError('No PDF data available to download.');
                return;
            }
            
            showLoader();
            
            try {
                const blob = new Blob([pdfData], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const filename = fileNameElement.textContent.trim() !== 'No file selected' ? 
                                fileNameElement.textContent : 'document.pdf';
                
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                
                setTimeout(() => {
                    a.click();
                    setTimeout(() => {
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        hideLoader();
                    }, 100);
                }, 100);
            } catch (error) {
                hideLoader();
                showError('Error downloading PDF: ' + error.message);
            }
        }

        // Print PDF
        function printPDF() {
            if (!pdfData) return;
            
            const blob = new Blob([pdfData], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = url;
            
            document.body.appendChild(iframe);
            
            iframe.onload = () => {
                iframe.contentWindow.print();
                setTimeout(() => {
                    document.body.removeChild(iframe);
                    URL.revokeObjectURL(url);
                }, 1000);
            };
        }

        // Handle keyboard shortcuts
        function handleKeyDown(e) {
            if (!pdfDoc) return;
            
            switch (e.key) {
                case 'ArrowLeft':
                    onPrevPage();
                    break;
                case 'ArrowRight':
                    onNextPage();
                    break;
                case '+':
                case '=':
                    if (scale < 3.0) {
                        scale += 0.25;
                        updateZoomLevel();
                        queueRenderPage(pageNum);
                    }
                    break;
                case '-':
                    if (scale > 0.5) {
                        scale -= 0.25;
                        updateZoomLevel();
                        queueRenderPage(pageNum);
                    }
                    break;
                case 'f':
                case 'F':
                    toggleFullscreen();
                    break;
                case 't':
                case 'T':
                    toggleTheme();
                    break;
            }
        }

        // Setup drag and drop
        function setupDragAndDrop() {
            const preventDefaults = e => {
                e.preventDefault();
                e.stopPropagation();
            };
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => {
                    dropArea.classList.add('active');
                }, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => {
                    dropArea.classList.remove('active');
                }, false);
            });
            
            dropArea.addEventListener('drop', e => {
                const dt = e.dataTransfer;
                const file = dt.files[0];
                handleFileSelect(file);
            });
        }

        // Draw constellation lines background
        function drawConstellationLines() {
            const starsContainer = document.getElementById('space-background');
            starsContainer.innerHTML = '';
            
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            const constellationCount = Math.max(3, Math.floor(Math.min(width, height) / 250));
            
            for (let c = 0; c < constellationCount; c++) {
                const pointCount = Math.floor(Math.random() * 5) + 5;
                const points = [];
                
                const centerX = Math.random() * width;
                const centerY = Math.random() * height;
                
                for (let i = 0; i < pointCount; i++) {
                    const distance = 50 + Math.random() * 150;
                    const angle = Math.random() * Math.PI * 2;
                    
                    const x = centerX + Math.cos(angle) * distance;
                    const y = centerY + Math.sin(angle) * distance;
                    
                    points.push({ x, y });
                    
                    const star = document.createElement('div');
                    star.className = 'constellation-star';
                    star.style.left = `${x}px`;
                    star.style.top = `${y}px`;
                    
                    const size = (2 + Math.random() * 4);
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    star.style.animationDelay = `${Math.random() * 3}s`;
                    
                    starsContainer.appendChild(star);
                }
                
                for (let i = 0; i < points.length - 1; i++) {
                    const distances = [];
                    
                    for (let j = 0; j < points.length; j++) {
                        if (i !== j) {
                            const dist = Math.sqrt(
                                Math.pow(points[j].x - points[i].x, 2) + 
                                Math.pow(points[j].y - points[i].y, 2)
                            );
                            distances.push({index: j, distance: dist});
                        }
                    }
                    
                    distances.sort((a, b) => a.distance - b.distance);
                    
                    const connectCount = Math.floor(Math.random() * 2) + 1;
                    for (let k = 0; k < Math.min(connectCount, distances.length); k++) {
                        createLine(points[i], points[distances[k].index]);
                    }
                }
            }
        }

        // Create a line between two points
        function createLine(point1, point2) {
            const distance = Math.sqrt(
                Math.pow(point2.x - point1.x, 2) + 
                Math.pow(point2.y - point1.y, 2)
            );
            
            const angle = Math.atan2(point2.y - point1.y, point2.x - point1.x);
            
            const line = document.createElement('div');
            line.className = 'constellation-line';
            line.style.width = `${distance}px`;
            line.style.height = '2px';
            line.style.left = `${point1.x}px`;
            line.style.top = `${point1.y}px`;
            line.style.transform = `rotate(${angle}rad)`;
            line.style.animationDelay = `${Math.random() * 5}s`;
            
            document.getElementById('space-background').appendChild(line);
        }

        // Show loader
        function showLoader() {
            loader.classList.add('active');
        }

        // Hide loader
        function hideLoader() {
            loader.classList.remove('active');
        }

        // Show error modal
        function showError(message) {
            errorMessage.textContent = message;
            errorModal.classList.add('show');
        }

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>