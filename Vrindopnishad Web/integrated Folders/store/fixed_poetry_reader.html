<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Vrindopnishad</title>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Rozha+One&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Lora:ital@0;1&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --text-color: #161f27;
            --font-headings: 'Rozha One', "Montserrat", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-body: 'Lora', "Roboto", "Helvetica Neue", Arial, sans-serif;
            --line-height: 1.8;
            --transition-smooth: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --transition-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --border-radius-md: 20px;
            --shadow-md: 0 15px 35px rgba(31, 38, 135, 0.5);
            
            /* Safari-compatible blur values */
            --blur-light: blur(10px);
            --blur-medium: blur(15px);
            --blur-heavy: blur(20px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: var(--line-height);
            color: var(--text-color);
            min-height: 100vh;
            font-size: 18px;
            position: relative;
            overflow-x: hidden;
            
            /* Enhanced Safari compatibility */
            background-color: #667eea; /* Fallback */
            background: #667eea;
            background: -webkit-gradient(linear, left top, right bottom, color-stop(0%, #667eea), color-stop(100%, #764ba2));
            background: -webkit-linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background: -moz-linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background: -o-linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            background-repeat: no-repeat;
        }

        /* Enhanced Safari-compatible background overlays */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            
            /* Multiple radial gradients with Safari fallbacks */
            background-color: rgba(120, 164, 170, 0.1); /* Fallback */
            background-image: 
                -webkit-radial-gradient(circle at 20% 80%, rgba(120, 164, 170, 0.4) 0%, rgba(120, 164, 170, 0) 50%),
                -webkit-radial-gradient(circle at 80% 20%, rgba(233, 208, 164, 0.4) 0%, rgba(233, 208, 164, 0) 50%),
                -webkit-radial-gradient(circle at 40% 40%, rgba(142, 68, 173, 0.3) 0%, rgba(142, 68, 173, 0) 50%);
            background-image: 
                -moz-radial-gradient(circle at 20% 80%, rgba(120, 164, 170, 0.4) 0%, rgba(120, 164, 170, 0) 50%),
                -moz-radial-gradient(circle at 80% 20%, rgba(233, 208, 164, 0.4) 0%, rgba(233, 208, 164, 0) 50%),
                -moz-radial-gradient(circle at 40% 40%, rgba(142, 68, 173, 0.3) 0%, rgba(142, 68, 173, 0) 50%);
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 164, 170, 0.4) 0%, rgba(120, 164, 170, 0) 50%),
                radial-gradient(circle at 80% 20%, rgba(233, 208, 164, 0.4) 0%, rgba(233, 208, 164, 0) 50%),
                radial-gradient(circle at 40% 40%, rgba(142, 68, 173, 0.3) 0%, rgba(142, 68, 173, 0) 50%);
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            pointer-events: none;
            animation: float 8s ease-in-out infinite;
        }

        .particle:nth-child(1) { animation-delay: -2s; }
        .particle:nth-child(2) { animation-delay: -4s; }
        .particle:nth-child(3) { animation-delay: -6s; }
        .particle:nth-child(4) { animation-delay: -8s; }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0px) translateX(0px) rotate(0deg);
                opacity: 0.7;
            }
            25% { 
                transform: translateY(-30px) translateX(10px) rotate(90deg);
                opacity: 1;
            }
            50% { 
                transform: translateY(-20px) translateX(-10px) rotate(180deg);
                opacity: 0.8;
            }
            75% { 
                transform: translateY(-40px) translateX(5px) rotate(270deg);
                opacity: 0.9;
            }
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            
            /* Enhanced Safari-compatible backdrop filter */
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-md);
        }

        .logo {
            font-family: var(--font-body);
            font-size: 1.8rem;
            font-weight: 600;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .author-header {
            font-family: "Poppins", sans-serif;
            font-size: 1.4rem;
            color: rgb(255, 255, 255);
            text-shadow: 0px 0px 8px rgba(255, 237, 132, 0.8);
            transition: all 0.5s var(--transition-smooth);
            animation: authorFade 2s var(--transition-smooth);
            max-width: 300px;
            text-align: right;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        @keyframes authorFade {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0px);
            }
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .toc-toggle {
            background: rgba(255, 255, 255, 0.15);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.7rem 1.2rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.4s var(--transition-bounce);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toc-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(31, 38, 135, 0.3);
        }

        .table-of-contents {
            position: fixed;
            top: 80px;
            left: -420px;
            width: 420px;
            height: calc(100vh - 80px);
            background: rgba(255, 255, 255, 0.12);
            
            /* Enhanced Safari-compatible backdrop filter */
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 999;
            transition: left 0.4s var(--transition-bounce);
            padding: 0;
            
            /* Custom scrollbar for webkit browsers */
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) rgba(255, 255, 255, 0.1);
        }

        .table-of-contents::-webkit-scrollbar {
            width: 6px;
        }

        .table-of-contents::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        .table-of-contents::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .table-of-contents::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .table-of-contents.active {
            left: 0;
        }

        .toc-header {
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0;
            padding: 2rem 1.5rem 1.5rem;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .toc-content {
            padding: 1rem 0;
        }

        .toc-item {
            background: rgba(255, 255, 255, 0.08);
            margin: 0.5rem 1rem;
            padding: 1.2rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s var(--transition-smooth);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .toc-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transform: scaleY(0);
            transition: transform 0.3s var(--transition-smooth);
        }

        .toc-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(31, 38, 135, 0.3);
        }

        .toc-item:hover::before {
            transform: scaleY(1);
        }

        .toc-item.current {
            background: rgba(103, 126, 234, 0.25);
            border-color: rgba(103, 126, 234, 0.5);
            box-shadow: 0 8px 25px rgba(103, 126, 234, 0.3);
        }

        .toc-item.current::before {
            transform: scaleY(1);
            background: linear-gradient(45deg, #ffd700, #ff6b35);
        }

        .toc-title {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .toc-meta {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            flex-wrap: wrap;
        }

        .toc-type {
            display: inline-block;
            background: rgba(142, 68, 173, 0.4);
            color: white;
            padding: 0.25rem 0.7rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toc-status {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .toc-excerpt {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .container {
            max-width: 900px;
            margin: 6rem auto 0;
            position: relative;
            padding: 0 2rem;
            transition: margin-left 0.4s var(--transition-bounce);
        }

        .container.toc-open {
            margin-left: 200px;
        }

        h1.dynamic-title {
            font-family: var(--font-headings);
            color: white;
            font-size: 3.5rem;
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 600;
            background: linear-gradient(135deg, #fff, rgba(255,255,255,0.7));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: opacity 0.5s var(--transition-smooth);
            animation: titleFade 0.5s var(--transition-smooth);
        }

        @keyframes titleFade {
            from {
                opacity: 0;
                transform: translateY(-15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .reader {
            background: rgba(255, 255, 255, 0.15);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            padding: 3rem;
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
            transition: all 0.4s var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }

        .reader::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 50%);
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }

        .reader:hover::before {
            opacity: 1;
        }

        .reader:hover {
            transform: translateY(-8px) scale(1.005);
            box-shadow: 0 25px 50px rgba(31, 38, 135, 0.3);
        }

        .poem-title {
            font-family: var(--font-headings);
            font-size: 2rem;
            color: #fff;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .poem-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: center;
        }

        .poem-author {
            font-style: italic;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
        }

        .poem-type, .poem-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .poem-type {
            background: rgba(103, 126, 234, 0.3);
            color: white;
            border: 1px solid rgba(103, 126, 234, 0.5);
        }

        .poem-status {
            background: rgba(46, 204, 113, 0.3);
            color: white;
            border: 1px solid rgba(46, 204, 113, 0.5);
        }

        .poem-status.draft {
            background: rgba(241, 196, 15, 0.3);
            border-color: rgba(241, 196, 15, 0.5);
        }

        .poem-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .tag {
            background: rgba(142, 68, 173, 0.3);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            border: 1px solid rgba(142, 68, 173, 0.5);
        }

        .poem-content {
            white-space: pre-line;
            font-size: 1.3rem;
            line-height: 2.2;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            position: relative;
            z-index: 1;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.15);
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-family: var(--font-body);
            font-weight: 500;
            transition: all 0.4s var(--transition-bounce);
        }

        .nav-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px) scale(1.05);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .poem-counter {
            color: white;
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .controls {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
            opacity: 0.8;
            transition: opacity 0.3s ease;
            z-index: 100;
        }

        .controls:hover {
            opacity: 1;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.15);
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-family: var(--font-body);
            font-weight: 500;
            transition: all 0.4s var(--transition-bounce);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px) scale(1.05);
        }

        .no-content {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.2rem;
            padding: 3rem;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* RESPONSIVE DESIGN */
        
        /* Large tablets and small desktops */
        @media (max-width: 1024px) {
            .container.toc-open {
                margin-left: 100px;
            }
            
            .table-of-contents {
                width: 380px;
                left: -380px;
            }
        }

        /* Tablets */
        @media (max-width: 768px) {
            header {
                padding: 1rem;
                height: 70px;
            }
            
            .logo {
                font-size: 1.4rem;
            }
            
            .author-header {
                font-size: 1rem;
                max-width: 40%;
                text-align: right;
            }
            
            .toc-toggle {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }
            
            .table-of-contents {
                width: 350px;
                left: -350px;
                top: 70px;
                height: calc(100vh - 70px);
            }
            
            .toc-header {
                font-size: 1.1rem;
                padding: 1.5rem 1rem 1rem;
            }
            
            .toc-item {
                margin: 0.4rem 0.8rem;
                padding: 1rem;
            }
            
            .container {
                margin-top: 5rem;
                padding: 0 1rem;
            }
            
            .container.toc-open {
                margin-left: 0;
            }
            
            .reader {
                padding: 2rem;
            }
            
            h1.dynamic-title {
                font-size: 2.5rem;
                margin-bottom: 1.5rem;
            }
            
            .poem-title {
                font-size: 1.6rem;
            }
            
            .poem-content {
                font-size: 1.2rem;
                line-height: 2;
            }
            
            .controls {
                bottom: 1rem;
                right: 1rem;
                gap: 0.5rem;
            }
            
            .control-btn {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
            
            .navigation {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-btn {
                padding: 0.7rem 1.2rem;
            }
        }

        /* Mobile phones */
        @media (max-width: 480px) {
            header {
                padding: 0.8rem;
            }
            
            .logo {
                font-size: 1.2rem;
            }
            
            .author-header {
                font-size: 0.9rem;
                max-width: 50%;
            }
            
            .table-of-contents {
                width: 300px;
                left: -300px;
            }
            
            .toc-header {
                font-size: 1rem;
                padding: 1.2rem 0.8rem 0.8rem;
            }
            
            .toc-item {
                margin: 0.3rem 0.6rem;
                padding: 0.8rem;
            }
            
            .toc-title {
                font-size: 1rem;
            }
            
            .container {
                padding: 0 0.8rem;
            }
            
            .reader {
                padding: 1.5rem;
            }
            
            h1.dynamic-title {
                font-size: 2rem;
            }
            
            .poem-title {
                font-size: 1.4rem;
            }
            
            .poem-content {
                font-size: 1.1rem;
            }
            
            .controls {
                bottom: 0.8rem;
                right: 0.8rem;
                flex-direction: column;
            }
            
            .control-btn {
                padding: 0.7rem;
                font-size: 0.8rem;
            }
        }

        /* Very small devices */
        @media (max-width: 360px) {
            .table-of-contents {
                width: 280px;
                left: -280px;
            }
            
            .reader {
                padding: 1.2rem;
            }
            
            h1.dynamic-title {
                font-size: 1.8rem;
            }
        }

        /* Overlay for mobile when TOC is open */
        .toc-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toc-overlay.active {
            display: block;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .toc-overlay {
                display: block;
            }
        }

        /* Dark theme */
        .dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }

        .dark-theme::before {
            background-image: 
                -webkit-radial-gradient(circle at 20% 80%, rgba(26, 26, 46, 0.4) 0%, rgba(26, 26, 46, 0) 50%),
                -webkit-radial-gradient(circle at 80% 20%, rgba(155, 89, 182, 0.3) 0%, rgba(155, 89, 182, 0) 50%),
                -webkit-radial-gradient(circle at 40% 40%, rgba(231, 76, 60, 0.2) 0%, rgba(231, 76, 60, 0) 50%);
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(26, 26, 46, 0.4) 0%, rgba(26, 26, 46, 0) 50%),
                radial-gradient(circle at 80% 20%, rgba(155, 89, 182, 0.3) 0%, rgba(155, 89, 182, 0) 50%),
                radial-gradient(circle at 40% 40%, rgba(231, 76, 60, 0.2) 0%, rgba(231, 76, 60, 0) 50%);
        }
    </style>
</head>
<body>
    <!-- Floating particles -->
    <div class="particle" style="top: 15%; left: 10%; width: 4px; height: 4px;"></div>
    <div class="particle" style="top: 25%; left: 85%; width: 6px; height: 6px;"></div>
    <div class="particle" style="top: 65%; left: 15%; width: 8px; height: 8px;"></div>
    <div class="particle" style="top: 75%; left: 90%; width: 5px; height: 5px;"></div>
    <div class="particle" style="top: 45%; left: 70%; width: 3px; height: 3px;"></div>
    <div class="particle" style="top: 55%; left: 30%; width: 7px; height: 7px;"></div>

    <header>
        <div class="logo">वृन्दोपनिषद्</div>
        <div class="header-controls">
            <button class="toc-toggle" id="tocToggle">📖 Contents</button>
        </div>
        <div id="authorDisplay" class="author-header"></div>
    </header>

    <!-- TOC Overlay for mobile -->
    <div class="toc-overlay" id="tocOverlay"></div>

    <!-- Table of Contents -->
    <div class="table-of-contents" id="tableOfContents">
        <div class="toc-header">Table of Contents</div>
        <div class="toc-content">
            <div id="tocItems"></div>
        </div>
    </div>

    <div class="container" id="mainContainer">
        <h1 id="dynamicTitle" class="dynamic-title">वृन्दोपनिषद्</h1>
        <div id="contentArea">
            <div class="no-content">
                <div class="loading"></div>
                <p>Loading poetry collection...</p>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="control-btn" id="fontDown">A-</button>
        <button class="control-btn" id="fontUp">A+</button>
        <button class="control-btn" id="themeToggle">🌙</button>
    </div>

    <script>
        // Global variables
        let allPoems = [];
        let filteredPoems = [];
        let currentIndex = 0;
        let currentFilter = 'all';

        // Enhanced sample data that works like the modern reader
        const sampleData = [
            {
                "id": 1,
                "title": "Radhe Krishna Bhajan",
                "type": "post",
                "status": "published",
                "excerpt": "श्री हरिवंश",
                "content": `Radhe Radhe, the divine name that echoes through Vrindavan,
Like the gentle breeze that carries the fragrance of jasmine,
Each syllable holds the essence of pure devotion,
A mantra that transforms hearts and awakens souls.

In the sacred groves where Krishna played his flute,
The name 'Radhe' dances on every leaf,
Written in golden letters by the wind itself,
A testimony to love that knows no bounds.

Radhe Radhe, oh sweet invocation,
That bridges the earthly and the divine,
In your repetition lies the path to liberation,
In your melody, the universe finds its rhyme.`,
                "tags": ["श्री हरिवंश", "राधे राधे", "जय जय श्री राधे", "भक्ति", "वृन्दावन"]
            },
            {
                "id": 2,
                "title": "Shyam Sundar",
                "type": "post",
                "status": "published",
                "excerpt": "श्री हरिवंश",
                "content": `Shyam, the dark-complexioned one, beautiful beyond compare,
His eyes hold the depth of cosmic oceans,
In his smile lies the warmth of a thousand suns,
And in his presence, all worries find their end.

The peacock feathers in his crown dance with joy,
As if celebrating his divine magnificence,
The yellow silk that adorns his form
Shines like captured moonbeams on earth.

Shyam Sundar, the enchanter of hearts,
Who stole butter and gave love in return,
In the sacred land of Gokul and Vrindavan,
His leela continues to inspire and transform.

Oh Shyam, your name is a healing balm,
For souls wounded by worldly strife,
In your remembrance, we find peace,
In your love, we discover eternal life.`,
                "tags": ["कृष्ण", "श्याम", "दिव्य प्रेम", "गोकुल", "लीला"]
            },
            {
                "id": 3,
                "title": "Radhe Shyam - Divine Union",
                "type": "post",
                "status": "published",
                "excerpt": "दिव्य मिलन",
                "content": `Radhe Shyam, the eternal lovers divine,
Their union transcends time and space,
In their love story lies the secret
Of how the soul meets its beloved.

Radha, the embodiment of devotion pure,
Shyam, the object of all love's desire,
Together they dance the cosmic dance
That sets every heart on spiritual fire.

In the groves of Vrindavan, under moonlit skies,
Their love becomes a teaching profound:
That separation is but an illusion,
And in true love, the one and many are found.

Radhe Shyam, Radhe Shyam,
The names that heal and bless,
In their repetition lies salvation,
In their love, eternal happiness.

O seeker, remember this divine pair,
Let their love transform your very being,
For in Radhe Shyam lies the answer
To what your soul has long been seeking.`,
                "tags": ["राधे कृष्ण", "एकता", "भक्तिगीत", "दिव्य प्रेम", "मोक्ष"]
            },
            {
                "id": 4,
                "title": "गोवर्धन गिरिधारी",
                "type": "post",
                "status": "published",
                "excerpt": "पर्वत उठाने वाले श्रीकृष्ण",
                "content": `गोवर्धन पर्वत को उठाने वाले,
श्रीकृष्ण गिरिधारी कहलाए,
इन्द्र के अहंकार को चूर करके,
ब्रजवासियों की रक्षा कराई।

सात दिन तक छोटी उंगली पर,
पूरा पर्वत संभाला था,
माखन चोर ने अपनी लीला से,
जग को मोहित किया था।

गिरिधर गोपाल, गिरिधर गोपाल,
तुम्हारी महिमा अपरंपार,
भक्तों की रक्षा करने वाले,
तुम हो सबके आधार।

हे गिरिधारी! हे मुरारी!
तुम्हारे चरणों में शीश झुकाएं,
जैसे गोवर्धन की रक्षा की,
वैसे हमारी भी रक्षा कराओ।`,
                "tags": ["गोवर्धन", "गिरिधारी", "लीला", "रक्षा", "भक्ति"]
            },
            {
                "id": 5,
                "title": "वृन्दावन की महिमा",
                "type": "post", 
                "status": "published",
                "excerpt": "पावन धाम",
                "content": `वृन्दावन धाम, पावन सी भूमि,
जहाँ कण-कण में बसे हैं श्याम,
यमुना के तट पर रास रचाया,
यहीं मिला राधा को प्रियतम।

कदम्b के वृक्ष, कुञ्ज गलियां,
गोपियों के गीत गूंजते हैं,
बांसुरी की मधुर तान सुनकर,
सभी प्राणी मोहित होते हैं।

गोकुल गांव, नन्द का घर,
यशोदा माँ का प्यार निराला,
बाल कृष्ण की नटखट लीलाएं,
हर दिल को करती हैं खुश।

वृन्दावन की रज में छुपे हैं,
करोड़ों भक्तों के सपने,
एक बार जो यहाँ आ जाए,
फिर न कहीं जाने की चाह।

हे वृन्दावन! हे पावन धाम!
तुम्हारी महिमा अपरंपार,
जो भी तुम्हें प्रेम से याद करे,
उसका तर जाता संसार।`,
                "tags": ["वृन्दावन", "धाम", "लीला स्थली", "राधा कृष्ण", "भक्ति भावना"]
            }
        ];

        // Initialize the application
        function initializeApp() {
            console.log('Initializing poetry reader...');
            
            // Start with sample data
            allPoems = [...sampleData];
            applyFilter(currentFilter);
            
            // Try to load from JSON file if available
            loadFromJSON();
            
            // Initialize event listeners
            initializeEventListeners();
        }

        function loadFromJSON() {
            fetch('json/content-export-2025-09-09.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('JSON file not found');
                    }
                    return response.json();
                })
                .then(data => {
                    if (Array.isArray(data) && data.length > 0) {
                        console.log('Loaded poems from JSON file:', data.length);
                        allPoems = data;
                        applyFilter(currentFilter);
                    }
                })
                .catch(error => {
                    console.log('Using sample data:', error.message);
                    // Sample data is already loaded, so continue
                });
        }

        // Get DOM elements
        const contentArea = document.getElementById('contentArea');
        const fontDown = document.getElementById('fontDown');
        const fontUp = document.getElementById('fontUp');
        const themeToggle = document.getElementById('themeToggle');
        const tocToggle = document.getElementById('tocToggle');
        const tableOfContents = document.getElementById('tableOfContents');
        const tocOverlay = document.getElementById('tocOverlay');
        const mainContainer = document.getElementById('mainContainer');
        const tocItems = document.getElementById('tocItems');

        // Initialize event listeners
        function initializeEventListeners() {
            // Table of contents toggle
            if (tocToggle) {
                tocToggle.addEventListener('click', toggleTOC);
            }

            // Close TOC when clicking overlay
            if (tocOverlay) {
                tocOverlay.addEventListener('click', closeTOC);
            }

            // Font controls
            if (fontDown) {
                fontDown.addEventListener('click', () => adjustFontSize('decrease'));
            }
            if (fontUp) {
                fontUp.addEventListener('click', () => adjustFontSize('increase'));
            }

            // Theme toggle
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleTheme);
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);

            // Window resize handler
            window.addEventListener('resize', handleWindowResize);
        }

        // Filter functionality
        function applyFilter(filterType) {
            currentFilter = filterType;
            
            // Filter to show only published posts
            filteredPoems = allPoems.filter(poem => 
                poem.type === 'post' && poem.status === 'published'
            );
            
            currentIndex = 0;
            updateTableOfContents();
            displayPoem();
            
            console.log(`Filtered poems: ${filteredPoems.length}`);
        }

        function updateTableOfContents() {
            if (!tocItems) return;
            
            tocItems.innerHTML = '';
            
            if (filteredPoems.length === 0) {
                tocItems.innerHTML = '<div class="no-content"><p>No content available</p></div>';
                return;
            }
            
            filteredPoems.forEach((poem, index) => {
                const tocItem = document.createElement('div');
                tocItem.className = 'toc-item';
                if (index === currentIndex) {
                    tocItem.classList.add('current');
                }
                
                tocItem.innerHTML = `
                    <div class="toc-title">${poem.title || 'Untitled'}</div>
                    <div class="toc-meta">
                        <span class="toc-type">${poem.type || 'poem'}</span>
                        <span class="toc-status">${poem.status || 'published'}</span>
                    </div>
                    ${poem.excerpt ? `<div class="toc-excerpt">${poem.excerpt}</div>` : ''}
                `;
                
                tocItem.addEventListener('click', () => {
                    currentIndex = index;
                    displayPoem();
                    updateTableOfContents();
                    
                    // Close TOC on mobile after selection
                    if (window.innerWidth <= 768) {
                        closeTOC();
                    }
                });
                
                tocItems.appendChild(tocItem);
            });
        }

        // TOC functions
        function toggleTOC() {
            const isActive = tableOfContents.classList.contains('active');
            
            if (isActive) {
                closeTOC();
            } else {
                openTOC();
            }
        }

        function openTOC() {
            tableOfContents.classList.add('active');
            if (window.innerWidth > 768) {
                mainContainer.classList.add('toc-open');
            }
            if (window.innerWidth <= 768) {
                tocOverlay.classList.add('active');
            }
        }

        function closeTOC() {
            tableOfContents.classList.remove('active');
            mainContainer.classList.remove('toc-open');
            tocOverlay.classList.remove('active');
        }

        // Display poem with proper formatting
        function displayPoem() {
            if (!contentArea) return;

            if (filteredPoems.length === 0) {
                contentArea.innerHTML = `
                    <div class="no-content">
                        <p>No content found</p>
                        <p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;">
                            Try loading a JSON file or check the sample content
                        </p>
                    </div>
                `;
                return;
            }

            const poem = filteredPoems[currentIndex];
            
            // Update the main title and author with animation
            updateHeaderInfo(poem);

            const navigation = filteredPoems.length > 1 ? `
                <div class="navigation">
                    <button class="nav-btn" ${currentIndex === 0 ? 'disabled' : ''} onclick="previousPoem()">← Previous</button>
                    <div class="poem-counter">${currentIndex + 1} of ${filteredPoems.length}</div>
                    <button class="nav-btn" ${currentIndex === filteredPoems.length - 1 ? 'disabled' : ''} onclick="nextPoem()">Next →</button>
                </div>
            ` : '';

            const tags = poem.tags && poem.tags.length > 0 ? 
                `<div class="poem-tags">${poem.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>` : '';

            const content = formatContent(poem.content || '');

            contentArea.innerHTML = `
                <div class="reader">
                    <h2 class="poem-title">${poem.title || 'वृन्दोपनिषद्'}</h2>
                    <div class="poem-meta">
                        <div class="poem-author">${poem.excerpt || 'वृन्दावन'}</div>
                        <div class="poem-type">${poem.type || 'भाव'}</div>
                        <div class="poem-status ${poem.status === 'draft' ? 'draft' : ''}">${poem.status || 'published'}</div>
                    </div>
                    ${tags}
                    <div class="poem-content">${content}</div>
                </div>
                ${navigation}
            `;

            // Update TOC current item
            updateTableOfContents();
        }

        function updateHeaderInfo(poem) {
            const dynamicTitle = document.getElementById('dynamicTitle');
            const authorDisplay = document.getElementById('authorDisplay');
            
            if (dynamicTitle) {
                dynamicTitle.style.opacity = '0';
                setTimeout(() => {
                    dynamicTitle.textContent = poem.title || 'वृन्दोपनिषद्';
                    dynamicTitle.style.opacity = '1';
                }, 250);
            }
            
            if (authorDisplay) {
                authorDisplay.style.opacity = '0';
                authorDisplay.style.transform = 'translateX(10px)';
                setTimeout(() => {
                    authorDisplay.textContent = poem.excerpt || '';
                    authorDisplay.style.opacity = '1';
                    authorDisplay.style.transform = 'translateX(0)';
                }, 250);
            }
        }

        function formatContent(content) {
            if (!content) return '';
            
            // Clean up the content and preserve line breaks
            return content
                .replace(/\r\n/g, '\n')
                .replace(/\r/g, '\n')
                .replace(/\n\s*\n\s*\n/g, '\n\n')
                .trim();
        }

        // Navigation functions (made global)
        window.previousPoem = function() {
            if (currentIndex > 0) {
                currentIndex--;
                displayPoem();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        };

        window.nextPoem = function() {
            if (currentIndex < filteredPoems.length - 1) {
                currentIndex++;
                displayPoem();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        };

        // Font size controls
        function adjustFontSize(action) {
            const content = document.querySelector('.poem-content');
            if (!content) return;

            const currentSize = parseFloat(window.getComputedStyle(content).fontSize);
            const minSize = 16;
            const maxSize = 40;
            let newSize;

            if (action === 'increase') {
                newSize = Math.min(currentSize * 1.15, maxSize);
            } else {
                newSize = Math.max(currentSize * 0.85, minSize);
            }

            content.style.fontSize = newSize + 'px';
            
            // Add scaling animation
            content.style.transform = 'scale(1.02)';
            setTimeout(() => {
                content.style.transform = 'scale(1)';
            }, 200);
        }

        // Theme toggle
        let isDark = false;
        function toggleTheme() {
            const body = document.body;
            
            if (isDark) {
                body.classList.remove('dark-theme');
                if (themeToggle) themeToggle.textContent = '🌙';
            } else {
                body.classList.add('dark-theme');
                if (themeToggle) themeToggle.textContent = '☀️';
            }
            isDark = !isDark;
            
            // Add smooth transition
            body.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            setTimeout(() => {
                body.style.transition = '';
            }, 600);
        }

        // Keyboard shortcuts
        function handleKeyboardShortcuts(e) {
            // Navigation shortcuts
            if (e.key === 'ArrowLeft' && currentIndex > 0) {
                window.previousPoem();
            }
            if (e.key === 'ArrowRight' && currentIndex < filteredPoems.length - 1) {
                window.nextPoem();
            }
            
            // Font size shortcuts
            if ((e.ctrlKey || e.metaKey) && e.key === '+') {
                e.preventDefault();
                adjustFontSize('increase');
            }
            if ((e.ctrlKey || e.metaKey) && e.key === '-') {
                e.preventDefault();
                adjustFontSize('decrease');
            }
            
            // Close TOC with Escape
            if (e.key === 'Escape') {
                closeTOC();
            }
            
            // Toggle TOC with 't'
            if (e.key === 't' || e.key === 'T') {
                toggleTOC();
            }
        }

        // Handle window resize
        function handleWindowResize() {
            if (window.innerWidth > 768) {
                tocOverlay.classList.remove('active');
                if (tableOfContents.classList.contains('active')) {
                    mainContainer.classList.add('toc-open');
                }
            } else {
                mainContainer.classList.remove('toc-open');
            }
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // Fallback initialization if DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // Add entrance animations
        window.addEventListener('load', () => {
            // Animate particles
            const particles = document.querySelectorAll('.particle');
            particles.forEach((particle, index) => {
                particle.style.animationDelay = `${index * 0.5}s`;
            });
            
            // Animate main content
            const reader = document.querySelector('.reader');
            if (reader) {
                reader.style.opacity = '0';
                reader.style.transform = 'translateY(30px)';
                reader.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                
                setTimeout(() => {
                    reader.style.opacity = '1';
                    reader.style.transform = 'translateY(0)';
                }, 300);
            }
        });
    </script>